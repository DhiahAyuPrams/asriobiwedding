(()=>{var m=(()=>{let l='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',u=c=>String(c).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),v=(c,r)=>(c.replaceChildren(document.createRange().createContextualFragment(r)),c),o=(c,r,T=.05)=>new Promise(A=>{let s=parseFloat(c.style.opacity),g=r?1:0,L=()=>{s+=r?T:-T,s=Math.max(0,Math.min(1,s)),c.style.opacity=s.toFixed(2),r&&s>=g||!r&&s<=g?(c.style.opacity=g.toString(),A(c)):requestAnimationFrame(L)};requestAnimationFrame(L)}),d=(c,r)=>{let T=null;T=setTimeout(()=>{c(),clearTimeout(T),T=null},r)};return{loader:l,copy:async(c,r=null,T=1500)=>{let A=c.getAttribute("data-copy");if(!A||A.length===0){alert("Nothing to copy");return}c.disabled=!0;try{await navigator.clipboard.writeText(A)}catch{c.disabled=!1,alert("Failed to copy");return}let s=c.innerHTML;v(c,r||'<i class="fa-solid fa-check"></i>'),d(()=>{c.disabled=!1,c.innerHTML=s},T)},timeOut:d,debounce:(c,r)=>{let T=null;return(...A)=>{clearTimeout(T),T=setTimeout(()=>c(...A),r)}},escapeHtml:u,base64Encode:c=>{let T=new TextEncoder().encode(c);return window.btoa(String.fromCharCode(...T))},base64Decode:c=>{let r=new TextDecoder,T=Uint8Array.from(window.atob(c),A=>A.charCodeAt(0));return r.decode(T)},disableButton:(c,r="Loading",T=!1)=>{c.disabled=!0;let A=c.innerHTML;return v(c,T?r:l+r),{restore:(s=!1)=>{c.innerHTML=A,c.disabled=s}}},disableCheckbox:c=>{c.disabled=!0;let r=document.querySelector(`label[for="${c.id}"]`),T=r.innerHTML;return v(r,l+T),{restore:()=>{r.innerHTML=T,c.disabled=!1}}},safeInnerHTML:v,parseUserAgent:c=>{let r=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],T=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],A=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],s=r.find(a=>a.regex.test(c))?.type||"Unknown",g=T.find(a=>a.regex.test(c))?.name||"Unknown",L=A.find(a=>a.regex.test(c)),D=L&&c.match(L.regex)?.[1]?.replace(/_/g,".")||"",_=L?L.name:"Unknown";return D=D?`${_} ${D}`:_,`${g} ${s} ${D}`},changeOpacity:o}})();var oe={tab:v=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(v)),modal:v=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(v))};var N=(()=>{let l=(r,T,A)=>({code:r,data:T,error:A}),u=(r=0)=>({love:r}),v=({uuid:r,own:T,name:A,presence:s,comment:g,created_at:L,is_admin:D,gif_url:_,ip:a,user_agent:n,comments:h,like:t})=>({uuid:r,own:T,name:A,presence:s,comment:g,created_at:L,is_admin:D??!1,gif_url:_,ip:a,user_agent:n,comments:h?.map(v)??[],like:u(t?.love??0)}),o=r=>r.map(v);return{uuidResponse:({uuid:r})=>({uuid:r}),baseResponse:l,tokenResponse:({token:r})=>({token:r}),statusResponse:({status:r})=>({status:r}),commentResponse:({name:r,presence:T,comment:A,is_admin:s,gif_url:g,created_at:L})=>({name:r,presence:T,comment:A,is_admin:s,gif_url:g,created_at:L}),likeCommentResponse:u,getCommentResponse:v,getCommentsResponse:o,getCommentsResponseV2:r=>({count:r.count,lists:o(r.lists)}),commentShowMore:(r,T=!1)=>({uuid:r,show:T}),postCommentRequest:(r,T,A,s,g)=>({id:r,name:T,presence:A,comment:s,gif_id:g}),postSessionRequest:(r,T)=>({email:r,password:T}),updateCommentRequest:(r,T,A)=>({presence:r,comment:T,gif_id:A})}})();var H=l=>{let u=(p=null)=>{let $=JSON.parse(localStorage.getItem(l));return p?$[String(p)]:$},v=(p,$)=>{let i=u();i[String(p)]=$,localStorage.setItem(l,JSON.stringify(i))},o=p=>Object.keys(u()).includes(String(p)),d=p=>{if(!o(p))return;let $=u();delete $[String(p)],localStorage.setItem(l,JSON.stringify($))},f=()=>localStorage.setItem(l,"{}");return localStorage.getItem(l)||f(),{set:v,get:u,has:o,clear:f,unset:d}};var F="GET",se="PUT",ee="POST",W="PATCH",le="DELETE",Y=200,ae=201,pe=500,Z={Accept:"application/json","Content-Type":"application/json"},M=(l,u)=>{let v=new AbortController,o={signal:v.signal,method:String(l).toUpperCase(),headers:new Headers(Z)};window.addEventListener("offline",()=>v.abort()),window.addEventListener("popstate",()=>v.abort());let d=0,f=1e3,p=0,$=document.body.getAttribute("data-url");return $&&$.slice(-1)==="/"&&($=$.slice(0,-1)),{send(i=null){return fetch($+u,o).then(y=>y.json().then(k=>{if(y.status>=pe&&(k.message??k[0]))throw new Error(k.message??k[0]);if(k.error)throw new Error(k.error[0]);return i&&(k.data=i(k.data)),N.baseResponse(k.code,k.data,k.error)})).catch(y=>{if(y.name==="AbortError")return console.warn("Fetch abort:",y),y;throw alert(y),new Error(y)})},withTimeout(i=3,y=1e3){return d=i,f=y,this},withCancel(i){return i==null?this:((async()=>(await i,v.abort()))(),this)},default(i=null){if(o.headers=new Headers(i??{}),d===0&&f===0)return fetch(u,o);let y=async()=>{try{let k=await fetch(u,o);if(!k.ok)throw new Error(`HTTP error! Status: ${k.status}`);return k}catch(k){if(k.name==="AbortError")throw k;if(f*=2,p++,p>=d)throw new Error(`Max retries reached: ${k}`);return console.warn(`Retrying fetch (${p}/${d}): ${u}`),await new Promise(w=>m.timeOut(w,f)),y()}};return y()},download(){return Object.keys(Z).forEach(i=>o.headers.delete(i)),fetch($+u,o).then(i=>{if(i.status!==Y)return!1;let y=document.querySelector("a[download]");y&&document.body.removeChild(y);let k=i.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return i.blob().then(w=>{let c=document.createElement("a"),r=window.URL.createObjectURL(w);return c.href=r,c.download=k,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(r),!0})}).catch(i=>{if(i.name==="AbortError")return console.warn("Fetch abort:",i),i;throw alert(i),new Error(i)})},token(i){return i.split(".").length===3?(o.headers.append("Authorization","Bearer "+i),this):(o.headers.append("x-access-key",i),this)},body(i){return o.body=JSON.stringify(i),this}}};var S=(()=>{let l=null,u=()=>l.get("token"),v=y=>l.set("token",y),o=y=>M(ee,"/api/session").body(y).send(N.tokenResponse).then(k=>(k.code===Y&&v(k.data.token),k.code===Y),()=>!1),d=()=>l.unset("token"),f=()=>String(u()??".").split(".").length===3;return{init:()=>{l=H("session")},guest:()=>M(F,"/api/config").token(u()).send().then(y=>{if(y.code!==Y)throw new Error("failed to get config.");let k=H("config");for(let[w,c]of Object.entries(y.data))k.set(w,c);return y}),login:o,logout:d,decode:()=>{if(!f())return null;try{return JSON.parse(m.base64Decode(u().split(".")[1]))}catch{return null}},isAdmin:f,setToken:v,getToken:u}})();var te=(()=>{let l=null,u=async p=>{let $=m.disableButton(p),i=document.getElementById("loginEmail"),y=document.getElementById("loginPassword");i.disabled=!0,y.disabled=!0,await S.login(N.postSessionRequest(i.value,y.value))&&(i.value=null,y.value=null,oe.modal("mainModal").hide()),$.restore(),i.disabled=!1,y.disabled=!1},v=()=>{l.clear(),S.logout(),oe.modal("mainModal").show()};return{init:()=>{l=H("user")},login:u,clearSession:v,getDetailUser:()=>M(F,"/api/user").token(S.getToken()).send().then(p=>{if(p.code!==Y)throw new Error("failed to get user.");return Object.entries(p.data).forEach(([$,i])=>l.set($,i)),p},p=>(v(),p)),getUserStorage:()=>l}})();var ce=(()=>{let l=(o,d)=>{document.querySelectorAll(".navbar button").forEach(f=>{f.classList.contains("active")&&f.classList.remove("active")}),oe.tab(d).show(),o.classList.add("active")};return{buttonNavHome:o=>{l(o,"button-home")},buttonNavSetting:o=>{l(o,"button-setting")}}})();var ie=(()=>{let l={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},u=["#ffffff","#f8f9fa"],v=["#000000","#212529"],o=!1,d=null,f=null,p=()=>d.set("active","light"),$=()=>d.set("active","dark"),i=s=>{let g=f.getAttribute("content");f.setAttribute("content",s.some(L=>L===g)?l[g]:g)},y=()=>{p(),document.documentElement.setAttribute("data-bs-theme","light"),i(v)},k=()=>{$(),document.documentElement.setAttribute("data-bs-theme","dark"),i(u)},w=(s=null,g=null)=>{let L=d.get("active")==="dark";return s&&g?L?s:g:L};return{init:()=>{switch(d=H("theme"),f=document.querySelector('meta[name="theme-color"]'),d.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?$():p()),document.documentElement.getAttribute("data-bs-theme")){case"dark":$();break;case"light":p();break;default:o=!0}w()?k():y()},spyTop:()=>{let s=L=>L.filter(D=>D.isIntersecting).forEach(D=>{let _=D.target.classList.contains("bg-white-black")?w(v[0],u[0]):w(v[1],u[1]);f.setAttribute("content",_)}),g=new IntersectionObserver(s,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(L=>g.observe(L))},change:()=>w()?y():k(),isDarkMode:w,isAutoMode:()=>o}})();var K=(()=>{let l={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},u=null,v=null,o=null,d=null;return{on(f,p){return d.set(f,p),this},get(){let f=d.get(o);return d.clear(),f},getCountry(){return u},getLocale(){return v},getLanguage(){return o},setDefault(f){let p=!0;l[f]||(p=!1,console.warn("Language not found, please add manually in countryMapping")),u=p?l[f]:"US",o=p?f:"en",v=`${o}_${u}`},init(){d=new Map,this.setDefault(navigator.language.split("-").shift())}}})();var de=(()=>{let l=null,u=!0,v=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],o=()=>u,d=()=>{let w=l.firstElementChild.firstElementChild;w.classList.remove("bg-success"),w.classList.add("bg-danger"),w.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},f=()=>{let w=l.firstElementChild.firstElementChild;w.classList.remove("bg-danger"),w.classList.add("bg-success"),w.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},p=async()=>{u&&(await m.changeOpacity(l,!1),d())},$=()=>{document.querySelectorAll(v.join(", ")).forEach(w=>{w.dispatchEvent(new Event(o()?"online":"offline")),w.setAttribute("data-offline-disabled",o()?"false":"true"),w.tagName==="BUTTON"?o()?w.classList.remove("disabled"):w.classList.add("disabled"):o()?w.removeAttribute("disabled"):w.setAttribute("disabled","true")})},i=()=>{u=!1,d(),m.changeOpacity(l,!0),$()},y=()=>{u=!0,f(),m.timeOut(p,3e3),$()};return{init:()=>{window.addEventListener("online",y),window.addEventListener("offline",i),l=document.getElementById("offline-mode"),l.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`},isOnline:o}})();var me=l=>{let u=new Map,v=[],o=null,d=1e3*60*60*6,f=(w,c,r=null)=>{u.set(w,[...u.get(w)??[],[c,r]])},p=async()=>{!o&&window.isSecureContext&&(o=await window.caches.open(l))},$=async(w,c=null)=>{await p();let r=()=>M(F,w).withCancel(c).withTimeout().default().then(T=>T.blob().then(A=>{if(!window.isSecureContext)return A;let s=new Headers,g=new Date(Date.now()+d);return s.set("Content-Length",String(A.size)),s.set("Expires",g.toUTCString()),s.set("Content-Type",T.headers.get("Content-Type")),o.put(w,new Response(A,{headers:s})).then(()=>A)}));return window.isSecureContext?o.match(w).then(T=>{if(!T)return r();let A=T.headers.get("Expires"),s=A?new Date(A).getTime():0;return Date.now()>s?o.delete(w).then(g=>g?r():T.blob()):T.blob()}):r()};return{setTtl:w=>{d=Number(w)},run:async(w=null)=>{let c=u.size;return await p(),window.isSecureContext||console.warn("Cache is not supported in insecure context"),new Promise(r=>{u.forEach(async(T,A)=>{try{let s=await $(A,w);for(let g of T)await g[0](s);v.forEach(g=>g(A))}catch(s){for(let g of T){let L=g[1];L&&await L(s)}}finally{c--,c===0&&(v.length=0,u.clear(),r())}})})},add:f,get:$,open:p,onEachComplete:w=>{v.push(w)}}};var P=(()=>{let l="gifs",u="default",v={128:2,256:3,512:4,768:5},o=null,d=null,f=null,p=null,$=null,i=(e,E)=>{let{id:B,media_formats:{tinygif:{url:C}},content_description:q}=E;e.pointer===-1||e.pointer===e.col-1?e.pointer=0:e.pointer++;let R=0;for(let j of e.lists.childNodes){if(R===e.pointer){d.add(C,ne=>{let G=URL.createObjectURL(ne);o.set(C,G),j.insertAdjacentHTML("beforeend",`
                    <figure class="gif-figure m-0 position-relative">
                        <button onclick="undangan.comment.gif.click('${e.uuid}', '${B}', '${m.base64Encode(C)}')" class="btn gif-checklist position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-1 m-1 rounded-circle border shadow-sm z-1">
                            <i class="fa-solid fa-circle-check"></i>
                        </button>
                        <img src="${G}" class="img-fluid" alt="${m.escapeHtml(q)}" style="width: 100%;">
                    </figure>`)});return}R++}},y=async()=>{await d.open()},k=async e=>(o.has(e)||o.set(e,URL.createObjectURL(await d.get(e))),o.get(e)),w=e=>{let E=e.lists,B=document.getElementById(`gif-loading-${e.uuid}`),C=document.getElementById(`progress-bar-${e.uuid}`),q=document.getElementById(`progress-info-${e.uuid}`),R=0,j=0;return E.classList.contains("d-none")||B.classList.replace("d-none","d-flex"),q.innerText=`${j}/${R}`,E.setAttribute("data-continue","false"),E.classList.replace("overflow-y-scroll","overflow-y-hidden"),{release:()=>{E.classList.contains("d-none")||B.classList.replace("d-flex","d-none"),C.style.width="0%",q.innerText=`${j}/${R}`,E.setAttribute("data-continue","true"),E.classList.replace("overflow-y-hidden","overflow-y-scroll")},until:ge=>{R=ge,q.innerText=`${j}/${R}`},step:()=>{j+=1,q.innerText=`${j}/${R}`,C.style.width=Math.min(j/R*100,100).toString()+"%"}}},c=(e,E,B)=>{B={media_filter:"tinygif",client_key:"undangan_app",key:$.get("tenor_key"),country:K.getCountry(),locale:K.getLocale(),...B??{}};let C=Object.keys(B).filter(R=>B[R]!==null&&B[R]!==void 0).map(R=>`${R}=${encodeURIComponent(B[R])}`).join("&"),q=`https://tenor.googleapis.com/v2${E}?${C}`;e.last=new Promise(R=>{let j=w(e),ne=new Promise(G=>{e.reqs.push(G)});(async()=>{try{let G=await M(F,q).withCancel(ne).default(Z).then(X=>X.json()).then(X=>{if(!X.error)return X;throw new Error(X.error.message)});if(G.results.length>0){e.next=G?.next,j.until(G.results.length),d.onEachComplete(j.step);for(let X of G.results)e.gifs.push(X),i(e,X);await d.run(ne)}}catch(G){G.name==="AbortError"?console.warn("Fetch abort:",G):alert(G)}finally{j.release(),R()}})()})},r=e=>(e=m.escapeHtml(e),`
        <label for="gif-search-${e}" class="form-label my-1"><i class="fa-solid fa-photo-film me-2"></i>Gif</label>

        <div class="d-flex mb-3" id="gif-search-nav-${e}">
            <button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1" onclick="undangan.comment.gif.back(this, '${e}')" data-offline-disabled="false"><i class="fa-solid fa-arrow-left"></i></button>
            <input type="text" name="gif-search" id="gif-search-${e}" autocomplete="on" class="form-control shadow-sm rounded-4" placeholder="Search for a GIF on Tenor" data-offline-disabled="false">
        </div>

        <div class="position-relative">
            <div class="position-absolute d-flex flex-column justify-content-center align-items-center top-50 start-50 translate-middle w-100 h-100 bg-overlay-auto rounded-4 z-3" id="gif-loading-${e}">
                <div class="progress w-25" role="progressbar" style="height: 0.5rem;" aria-label="progress bar">
                    <div class="progress-bar" id="progress-bar-${e}" style="width: 0%"></div>
                </div>
                <small class="mt-1 text-theme-auto bg-theme-auto py-0 px-2 rounded-4" id="progress-info-${e}" style="font-size: 0.7rem;"></small>
            </div>
            <div id="gif-lists-${e}" class="d-flex rounded-4 p-0 overflow-y-scroll border" data-continue="true" style="height: 15rem;"></div>
        </div>

        <figure class="d-flex m-0 position-relative" id="gif-result-${e}">
            <button onclick="undangan.comment.gif.cancel('${e}')" id="gif-cancel-${e}" class="btn d-none position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-2 m-1 rounded-circle border shadow-sm z-1">
                <i class="fa-solid fa-circle-xmark"></i>
            </button>
        </figure>`),T=async e=>{e.reqs.forEach(E=>E()),e.reqs.length=0,e.last&&(await e.last,e.last=null)},A=async e=>{await T(e);let E=e.col??0,B=0;for(let[q,R]of Object.entries(v))B=R,e.lists.clientWidth>=parseInt(q)&&(e.col=B);if(e.col===null&&(e.col=B),E===e.col||(e.pointer=-1,e.limit=e.col*5,e.lists.innerHTML='<div class="d-flex flex-column"></div>'.repeat(e.col),e.gifs.length===0))return;let C=w(e);C.until(e.gifs.length),d.onEachComplete(C.step);try{e.gifs.forEach(q=>i(e,q)),await d.run()}catch{e.gifs.length=0}E!==e.col&&e.lists.scroll({top:e.lists.scrollHeight,behavior:"instant"}),C.release(),e.gifs.length===0&&await A(e)},s=async e=>{if(e.lists.getAttribute("data-continue")!=="true"||!e.next||e.next.length===0)return;let E=e.query&&e.query.trim().length>0,B={pos:e.next,limit:e.limit};E&&(B.q=e.query),e.lists.scrollTop>(e.lists.scrollHeight-e.lists.clientHeight)*.8&&(await A(e),c(e,E?"/search":"/featured",B))},g=async(e,E=null)=>{e.query=E!==null?E:e.query,(!e.query||e.query.trim().length===0)&&(e.query=null),e.col=null,e.next=null,e.pointer=-1,e.gifs.length=0,await A(e),c(e,e.query===null?"/featured":"/search",{q:e.query,limit:e.limit})},L=e=>{if(!f.has(e)){m.safeInnerHTML(document.getElementById(`gif-form-${e}`),r(e)),f.set(e,{uuid:e,last:null,limit:null,query:null,next:null,col:null,pointer:-1,gifs:[],reqs:[],lists:document.getElementById(`gif-lists-${e}`)});let E=f.get(e),B=m.debounce(g,750),C=m.debounce(s,250);E.lists.addEventListener("scroll",()=>C(E)),document.getElementById(`gif-search-${e}`).addEventListener("input",q=>B(E,q.target.value))}return f.get(e)};return{default:u,init:()=>{o=new Map,f=new Map,p=new Map,d=me(l),$=H("config"),$.get("tenor_key")===null&&document.querySelector('[onclick="undangan.comment.gif.open(undangan.comment.gif.default)"]')?.remove()},get:k,back:async(e,E)=>{let B=m.disableButton(e,m.loader.replace("me-1","me-0"),!0);await T(f.get(E)),B.restore(),document.getElementById(`gif-form-${E}`).classList.toggle("d-none",!0),document.getElementById(`comment-form-${E}`)?.classList.toggle("d-none",!1)},open:e=>{let E=L(e);return document.getElementById(`gif-form-${e}`).classList.toggle("d-none",!1),document.getElementById(`comment-form-${e}`)?.classList.toggle("d-none",!0),p.has(e)&&p.get(e)(),g(E)},cancel:e=>{let E=document.getElementById(`gif-result-${e}`);E.removeAttribute("data-id"),E.querySelector(`#gif-cancel-${e}`).classList.replace("d-flex","d-none"),E.querySelector("img").remove(),f.get(e).lists.classList.replace("d-none","d-flex"),document.getElementById(`gif-search-nav-${e}`).classList.replace("d-none","d-flex")},click:(e,E,B)=>{let C=document.getElementById(`gif-result-${e}`);C.setAttribute("data-id",E),C.querySelector(`#gif-cancel-${e}`).classList.replace("d-none","d-flex"),C.insertAdjacentHTML("beforeend",`<img src="${o.get(m.base64Decode(B))}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">`),f.get(e).lists.classList.replace("d-flex","d-none"),document.getElementById(`gif-search-nav-${e}`).classList.replace("d-flex","d-none")},remove:async(e=null)=>{e?f.has(e)&&(await T(f.get(e)),p.delete(e),f.delete(e)):(await Promise.all(Array.from(f.keys()).map(E=>T(f.get(E)))),p.clear(),f.clear())},isOpen:e=>{let E=document.getElementById(`gif-form-${e}`);return E===null?!1:!E.classList.contains("d-none")},onOpen:(e,E)=>p.set(e,E),getResultId:e=>document.getElementById(`gif-result-${e}`)?.getAttribute("data-id"),buttonCancel:(e=null)=>{let E=document.getElementById(`gif-cancel-${e||u}`);return{show:()=>E.classList.replace("d-none","d-flex"),hide:()=>E.classList.replace("d-flex","d-none"),click:()=>E.dispatchEvent(new Event("click"))}},removeGifSearch:e=>document.querySelector(`[for="gif-search-${e}"]`)?.remove(),removeButtonBack:e=>document.querySelector(`[onclick="undangan.comment.gif.back(this, '${e}')"]`)?.remove(),prepareCache:y}})();var V=(()=>{let l=null,u=null,v=null,o=null,d=null,f=null,p=300,$=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],i=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,y=t=>($.forEach(b=>{let x=b[0],I=b[1];t=t.replace(new RegExp(`\\${x}(?=\\S)(.*?)(?<!\\s)\\${x}`,"gs"),I)}),t),k=t=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${t.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${t.like.love}">${t.like.love}</span>
            <i class="me-1 ${v.has(t.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,w=t=>{let b=`<div class="d-flex justify-content-start align-items-center" data-button-action="${t.uuid}">`;return(o.get("can_reply")===!0||o.get("can_reply")===void 0)&&(b+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply(this)" data-uuid="${t.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),u.has(t.uuid)&&(o.get("can_edit")===!0||o.get("can_edit")===void 0)&&!(t.gif_url&&o.get("tenor_key")===null)&&(b+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this)" data-uuid="${t.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),S.isAdmin()?b+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${t.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${t.own}" data-offline-disabled="false">Delete</button>`:u.has(t.uuid)&&(o.get("can_delete")===!0||o.get("can_delete")===void 0)&&(b+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${t.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),b+="</div>",b},c=(t,b)=>{t=m.escapeHtml(t);let x=f.get("show").includes(t);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${t}" data-uuids="${m.escapeHtml(b.join(","))}" data-show="${x?"true":"false"}" role="button" class="me-auto ms-1 py-0">${x?"Hide replies":`Show replies (${b.length})`}</a>`},r=t=>`
        <div class="d-flex justify-content-between align-items-center" id="button-${t.uuid}">
            ${w(t)}
            ${t.comments.length>0?c(t.uuid,t.comments.map(b=>b.uuid)):""}
            ${k(t)}
        </div>`,T=t=>t.ip===void 0||t.user_agent===void 0||t.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${t.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${m.escapeHtml(t.ip)} ${d.has(t.ip)?`<strong>${d.get(t.ip)}</strong>`:'<span class="mb-1 placeholder col-2 rounded-3"></span>'}</p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${m.parseUserAgent(m.escapeHtml(t.user_agent))}</p>
        </div>`,A=(t,b)=>b?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4" data-parent="true"':`class="${f.get("hidden").find(x=>x.uuid===t.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,s=(t,b)=>t.is_admin?`<strong class="me-1">${m.escapeHtml(l.get("name")??o.get("name"))}</strong><i class="fa-solid fa-certificate text-primary"></i>`:b?`<strong class="me-1">${m.escapeHtml(t.name)}</strong><i id="badge-${t.uuid}" data-is-presence="${t.presence?"true":"false"}" class="fa-solid ${t.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${m.escapeHtml(t.name)}</strong>`,g=async(t,b)=>{let x=`
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${s(t,b)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${t.created_at}</small>
        </div>
        <hr class="my-1">`;if(t.gif_url)return x+`
            <div class="d-flex justify-content-center align-items-center my-2">
                <img src="${await P.get(t.gif_url)}" id="img-gif-${t.uuid}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">
            </div>`;let I=y(m.escapeHtml(t.comment)),O=I.length>p;return x+`
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" ${O?`data-comment="${m.base64Encode(I)}"`:""} id="content-${t.uuid}">${O?I.slice(0,p)+"...":I}</p>
        ${O?`<p class="d-block mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem;" data-show="false" onclick="undangan.comment.showMore(this, '${t.uuid}')">Selengkapnya</a></p>`:""}`},L=async(t,b=!1)=>{let x=await g(t,b),I=await Promise.all(t.comments.map(O=>L(O)));return`
        <div ${A(t,b)} id="${t.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${t.uuid}" data-tapTime="0" data-liked="false" tabindex="0">${x}</div>
            ${T(t)}
            ${r(t)}
            <div id="reply-content-${t.uuid}">${I.join("")}</div>
        </div>`};return{init:()=>{l=H("user"),u=H("owns"),v=H("likes"),o=H("config"),d=H("tracker"),f=H("comment")},renderEdit:(t,b,x,I)=>{t=m.escapeHtml(t);let O=document.createElement("div");O.classList.add("my-2"),O.id=`inner-${t}`;let U=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</p>
        ${x?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${t}" data-offline-disabled="false">
            <option value="1" ${b?"selected":""}>&#9989; Datang</option>
            <option value="2" ${b?"":"selected"}>&#10060; Berhalangan</option>
        </select>`:""}
        ${I?`${o.get("tenor_key")===null?"":`<div class="d-none mb-2" id="gif-form-${t}"></div>`}`:`<textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${t}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>    
        `}
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${t}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${t}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`;return m.safeInnerHTML(O,U)},renderReply:t=>{t=m.escapeHtml(t);let b=document.createElement("div");b.classList.add("my-2"),b.id=`inner-${t}`;let x=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</p>
        <div class="d-block mb-2" id="comment-form-${t}">
            <div class="position-relative">
                ${o.get("tenor_key")===null?"":`<button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1 position-absolute bottom-0 end-0" onclick="undangan.comment.gif.open('${t}')" aria-label="button gif" data-offline-disabled="false"><i class="fa-solid fa-photo-film"></i></button>`}
                <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${t}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
            </div>
        </div>
        <div class="d-none mb-2" id="gif-form-${t}"></div>
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${t}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${t}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`;return m.safeInnerHTML(b,x)},renderLoading:i,renderReadMore:c,renderContentMany:t=>P.prepareCache().then(()=>Promise.all(t.map(b=>L(b,!0)))).then(b=>b.join("")),renderContentSingle:t=>P.prepareCache().then(()=>L(t)),convertMarkdownToHTML:y,maxCommentLength:p}})();var he=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]});var ue=l=>{if(!window.confetti)return;let u=Date.now()+25,v=Math.max(.3,Math.min(1,l.getBoundingClientRect().top/window.innerHeight+.2)),o=he(),d=["#FF69B4","#FF1493"],f=()=>{d.forEach(p=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[o],origin:{x:0,y:v},zIndex:1057,colors:[p]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[o],origin:{x:1,y:v},zIndex:1057,colors:[p]})}),Date.now()<u&&requestAnimationFrame(f)};requestAnimationFrame(f)};var Q=(()=>{let l=null,u=null,v=async i=>{let y=i.firstElementChild,k=i.lastElementChild,w=i.getAttribute("data-uuid"),c=parseInt(y.getAttribute("data-count-like"));i.disabled=!0,navigator.vibrate&&navigator.vibrate(100),l.has(w)?await M(W,"/api/comment/"+l.get(w)).token(S.getToken()).send(N.statusResponse).then(r=>{r.data.status&&(l.unset(w),k.classList.remove("fa-solid","text-danger"),k.classList.add("fa-regular"),y.setAttribute("data-count-like",String(c-1)))}):await M(ee,"/api/comment/"+w).token(S.getToken()).send(N.uuidResponse).then(r=>{r.code===ae&&(l.set(w,r.data.uuid),k.classList.remove("fa-regular"),k.classList.add("fa-solid","text-danger"),y.setAttribute("data-count-like",String(c+1)))}),y.innerText=y.getAttribute("data-count-like"),i.disabled=!1},o=i=>document.querySelector(`button[onclick="undangan.comment.like.love(this)"][data-uuid="${i}"]`),d=async i=>{if(!navigator.onLine)return;let y=Date.now(),k=y-parseInt(i.getAttribute("data-tapTime")),w=i.id.replace("body-content-",""),c=k<300&&k>0,r=!l.has(w)&&i.getAttribute("data-liked")!=="true";c&&r&&(ue(i),i.setAttribute("data-liked","true"),await v(o(w)),i.setAttribute("data-liked","false")),i.setAttribute("data-tapTime",y)};return{init:()=>{u=new Map,l=H("likes")},love:v,tapTap:d,getButtonLike:o,addListener:i=>{let y=new AbortController,k=document.getElementById(`body-content-${i}`);k.addEventListener("touchend",()=>d(k),{signal:y.signal}),u.set(i,y)},removeListener:i=>{let y=u.get(i);y&&(y.abort(),u.delete(i))}}})();var J=(()=>{let l=10,u=0,v=0,o=null,d=null,f=null,p=null,$=null,i=_=>{l=Number(_)},y=()=>l,k=()=>u,w=()=>v,c=()=>d.classList.contains("disabled")?null:d.classList.add("disabled"),r=()=>d.classList.contains("disabled")?d.classList.remove("disabled"):null,T=()=>f.classList.contains("disabled")?null:f.classList.add("disabled"),A=()=>f.classList.contains("disabled")?f.classList.remove("disabled"):null,s=_=>{T(),c();let a=m.disableButton(_,m.loader.replace("ms-0 me-1","mx-1"),!0),n=()=>{$.addEventListener("comment.done",()=>a.restore(),{once:!0}),$.addEventListener("comment.result",()=>$.scrollIntoView(),{once:!0}),$.dispatchEvent(new Event("comment.show"))};return{next:()=>{u+=l,_.innerHTML="Next"+_.innerHTML,n()},prev:()=>{u-=l,_.innerHTML=_.innerHTML+"Prev",n()}}};return{init:()=>{p=document.getElementById("pagination"),p.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page"></span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,$=document.getElementById("comments"),o=document.getElementById("page"),d=document.getElementById("previous"),f=document.getElementById("next")},setPer:i,getPer:y,getNext:k,reset:()=>u===0?!1:(u=0,T(),c(),!0),setTotal:_=>{if(v=Number(_),v<=l&&u===0){p.classList.add("d-none");return}let a=u/l+1,n=Math.ceil(v/l);if(o.innerText=`${a} / ${n}`,u>0&&r(),a>=n){T();return}A(),p.classList.contains("d-none")&&p.classList.remove("d-none")},geTotal:w,previous:_=>s(_).prev(),next:_=>s(_).next()}})();var re=(()=>{let l=null,u=null,v=null,o=null,d=null,f=[],p=()=>`<div class="text-center p-4 mx-0 mt-0 mb-3 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">${K.on("id","\u{1F4E2} Yuk, share undangan ini biar makin rame komentarnya! \u{1F389}").on("en","\u{1F4E2} Let's share this invitation to get more comments! \u{1F389}").get()}</p></div>`,$=(a,n)=>{document.querySelector(`[data-button-action="${a}"]`).childNodes.forEach(h=>{h.disabled=n})},i=a=>{$(a,!1),document.getElementById(`inner-${a}`).remove()},y=a=>{let n=a.getAttribute("data-uuids").split(","),h=a.getAttribute("data-show")==="true",t=a.getAttribute("data-uuid");h?(a.setAttribute("data-show","false"),a.innerText=`Show replies (${n.length})`,o.set("show",o.get("show").filter(b=>b!==t))):(a.setAttribute("data-show","true"),a.innerText="Hide replies",o.set("show",o.get("show").concat([t])));for(let b of n){o.set("hidden",o.get("hidden").map(I=>(I.uuid===b&&(I.show=!h),I)));let x=document.getElementById(b).classList;h?x.add("d-none"):x.remove("d-none")}},k=(a,n)=>{let h=document.getElementById(`content-${n}`),t=m.base64Decode(h.getAttribute("data-comment")),b=a.getAttribute("data-show")==="false";m.safeInnerHTML(h,b?t:t.slice(0,V.maxCommentLength)+"..."),a.innerText=b?"Sebagian":"Selengkapnya",a.setAttribute("data-show",b?"true":"false")},w=async a=>{if(!S.isAdmin()||(a.comments&&await Promise.all(a.comments.map(h=>w(h))),a.ip===void 0||a.user_agent===void 0||a.is_admin))return;let n=(h,t,b)=>{m.safeInnerHTML(document.getElementById(`ip-${m.escapeHtml(h)}`),`<i class="fa-solid fa-location-dot me-1"></i>${m.escapeHtml(t)} <strong>${m.escapeHtml(b)}</strong>`)};if(v.has(a.ip)){n(a.uuid,a.ip,v.get(a.ip));return}await M(F,`https://freeipapi.com/api/json/${a.ip}`).default(Z).then(h=>h.json()).then(h=>{let t=h.cityName+" - "+h.regionName;h.cityName==="-"&&h.regionName==="-"&&(t="localhost"),v.set(a.ip,t),n(a.uuid,a.ip,t)}).catch(h=>n(a.uuid,a.ip,h.message))},c=(a,n=[])=>(a.forEach(h=>{n.find(t=>t.uuid===h.uuid)||n.push(N.commentShowMore(h.uuid)),h.comments&&h.comments.length>0&&c(h.comments,n)}),n),r=()=>{for(let a of f)Q.removeListener(a);return d.getAttribute("data-loading")==="false"&&(d.setAttribute("data-loading","true"),d.innerHTML=V.renderLoading().repeat(J.getPer())),M(F,`/api/v2/comment?per=${J.getPer()}&next=${J.getNext()}&lang=${K.getLanguage()}`).token(S.getToken()).send(N.getCommentsResponseV2).then(async a=>{d.setAttribute("data-loading","false");for(let h of f)await P.remove(h);if(a.data.lists.length===0)return d.innerHTML=p(),a;f=c(a.data.lists).map(h=>h.uuid),o.set("hidden",c(a.data.lists,o.get("hidden")));let n=await V.renderContentMany(a.data.lists);a.data.lists.length<J.getPer()&&(n+=p()),m.safeInnerHTML(d,n);for(let h of f)Q.addListener(h);return a}).then(async a=>(d.dispatchEvent(new Event("comment.result")),a.data.lists.length>0&&await Promise.all(a.data.lists.map(n=>w(n))),J.setTotal(a.data.count),d.dispatchEvent(new Event("comment.done")),a))};return{gif:P,like:Q,pagination:J,init:()=>{P.init(),Q.init(),V.init(),J.init(),d=document.getElementById("comments"),d.addEventListener("comment.show",r),l=H("owns"),u=H("user"),v=H("tracker"),o=H("comment"),o.has("hidden")||o.set("hidden",[]),o.has("show")||o.set("show",[])},send:async a=>{let n=a.getAttribute("data-uuid"),h=document.getElementById("form-name"),t=h.value;if(S.isAdmin()&&(t=u.get("name")),t.length===0){alert("Name cannot be empty."),n&&h.scrollIntoView({block:"center"});return}let b=document.getElementById("form-presence");if(!n&&b&&b.value==="0"){alert("Please select your attendance status.");return}let x=P.isOpen(n||P.default),I=P.getResultId(n||P.default),O=P.buttonCancel(n);if(x&&!I){alert("Gif cannot be empty.");return}x&&I&&O.hide();let U=document.getElementById(`form-${n?`inner-${n}`:"comment"}`);if(!x&&U.value?.trim().length===0){alert("Comments cannot be empty.");return}!n&&h&&!S.isAdmin()&&(h.disabled=!0),!S.isAdmin()&&b&&b.value!=="0"&&(b.disabled=!0),U&&(U.disabled=!0);let z=document.querySelector(`[onclick="undangan.comment.cancel(this, '${n}')"]`);z&&(z.disabled=!0);let e=m.disableButton(a),E=b?b.value==="1":!0;if(!S.isAdmin()){let C=H("information");C.set("name",t),n||C.set("presence",E)}let B=await M(ee,`/api/comment?lang=${K.getLanguage()}`).token(S.getToken()).body(N.postCommentRequest(n,t,E,x?null:U.value,I)).send(N.getCommentResponse).then(C=>C,()=>null);if(h&&(h.disabled=!1),U&&(U.disabled=!1),z&&(z.disabled=!1),b&&(b.disabled=!1),x&&I&&O.show(),e.restore(),!(!B||B.code!==ae)){if(l.set(B.data.uuid,B.data.own),U&&(U.value=null),x&&I&&O.click(),!n){if(J.reset()){await r(),d.scrollIntoView();return}J.setTotal(J.geTotal()+1),d.children.length===J.getPer()&&d.lastElementChild.remove(),B.data.is_admin=S.isAdmin();let C=await V.renderContentMany([B.data]);d.insertAdjacentHTML("afterbegin",C),d.scrollIntoView()}if(n){o.set("hidden",o.get("hidden").concat([N.commentShowMore(B.data.uuid,!0)])),o.set("show",o.get("show").concat([n])),i(n),B.data.is_admin=S.isAdmin(),document.getElementById(`reply-content-${n}`).insertAdjacentHTML("beforeend",await V.renderContentSingle(B.data));let C=document.getElementById(`button-${n}`).querySelector("a"),q=[B.data.uuid];C&&(C.getAttribute("data-show")==="false"&&y(C),C.remove());let R=document.createRange().createContextualFragment(V.renderReadMore(n,C?C.getAttribute("data-uuids").split(",").concat(q):q)),j=Q.getButtonLike(n);j.parentNode.insertBefore(R,j)}Q.addListener(B.data.uuid),f.push(B.data.uuid)}},edit:async a=>{let n=a.getAttribute("data-uuid");if(document.getElementById(`inner-${n}`))return;$(n,!0);let h=m.disableButton(a);await M(F,"/api/comment/"+n).token(S.getToken()).send(N.commentResponse).then(async t=>{if(t.code!==Y)return t;t.data.gif_url&&await P.remove(n);let b=document.getElementById(n).getAttribute("data-parent")==="true"&&!S.isAdmin();if(document.getElementById(`button-${n}`).insertAdjacentElement("afterend",V.renderEdit(n,t.data.presence,b,!!t.data.gif_url)),t.data.gif_url)return P.onOpen(n,()=>{P.removeGifSearch(n),P.removeButtonBack(n)}),P.open(n);let x=document.getElementById(`form-inner-${n}`);return x.value=t.data.comment,x.setAttribute("data-original",m.base64Encode(t.data.comment)),t}),h.restore(!0)},reply:async a=>{let n=a.getAttribute("data-uuid");if(document.getElementById(`inner-${n}`))return;$(n,!0);let h=m.disableButton(a);await P.remove(n),P.onOpen(n,()=>P.removeGifSearch(n)),h.restore(!0),document.getElementById(`button-${n}`).insertAdjacentElement("afterend",V.renderReply(n))},remove:async a=>{if(!confirm("Are you sure?"))return;let n=a.getAttribute("data-uuid");S.isAdmin()&&l.set(n,a.getAttribute("data-own")),$(n,!0);let h=m.disableButton(a),t=Q.getButtonLike(n);if(t.disabled=!0,!await M(le,"/api/comment/"+l.get(n)).token(S.getToken()).send(N.statusResponse).then(x=>x.data.status,()=>!1)){h.restore(),t.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(x=>{let I=x.getAttribute("data-uuids").split(",");if(I.find(O=>O===n)){let O=I.filter(U=>U!==n).join(",");O.length===0?x.remove():x.setAttribute("data-uuids",O)}}),l.unset(n),document.getElementById(n).remove(),d.children.length===0&&(d.innerHTML=p())},update:async a=>{let n=a.getAttribute("data-uuid"),h=!1,t=document.getElementById(`form-inner-presence-${n}`);t&&(t.disabled=!0,h=t.value==="1");let b=!1,x=document.getElementById(`badge-${n}`);x&&(b=x.getAttribute("data-is-presence")==="true");let I=P.isOpen(n),O=P.getResultId(n),U=P.buttonCancel(n);if(I&&!O){alert("Gif cannot be empty.");return}I&&O&&U.hide();let z=document.getElementById(`form-inner-${n}`);if(n&&!I&&m.base64Encode(z.value)===z.getAttribute("data-original")&&b===h){i(n);return}if(!I&&z.value?.trim().length===0){alert("Comments cannot be empty.");return}z&&(z.disabled=!0);let e=document.querySelector(`[onclick="undangan.comment.cancel(this, '${n}')"]`);e&&(e.disabled=!0);let E=m.disableButton(a),B=await M(se,`/api/comment/${l.get(n)}?lang=${K.getLanguage()}`).token(S.getToken()).body(N.updateCommentRequest(t?h:null,I?null:z.value,O)).send(N.statusResponse).then(C=>C.data.status,()=>!1);if(z&&(z.disabled=!1),e&&(e.disabled=!1),t&&(t.disabled=!1),E.restore(),I&&O&&U.show(),!!B){if(I&&O&&(document.getElementById(`img-gif-${n}`).src=document.getElementById(`gif-result-${n}`)?.querySelector("img").src,U.click()),i(n),!I){let C=document.querySelector(`[onclick="undangan.comment.showMore(this, '${n}')"]`),q=V.convertMarkdownToHTML(m.escapeHtml(z.value)),R=document.getElementById(`content-${n}`);q.length>V.maxCommentLength?(m.safeInnerHTML(R,C?.getAttribute("data-show")==="false"?q.slice(0,V.maxCommentLength)+"...":q),R.setAttribute("data-comment",m.base64Encode(q)),C?.classList.replace("d-none","d-block")):(m.safeInnerHTML(R,q),R.removeAttribute("data-comment"),C?.classList.replace("d-block","d-none"))}t&&(document.getElementById("form-presence").value=h?"1":"2",H("information").set("presence",h)),!(!t||!x)&&(x.classList.toggle("fa-circle-xmark",!h),x.classList.toggle("text-danger",!h),x.classList.toggle("fa-circle-check",h),x.classList.toggle("text-success",h))}},cancel:async(a,n)=>{let h=document.getElementById(`form-inner-presence-${n}`),t=h?h.value==="1":!1,b=document.getElementById(`badge-${n}`),x=b&&l.has(n)&&h?b.getAttribute("data-is-presence")==="true":!1;if(m.disableButton(a),P.isOpen(n)&&(!P.getResultId(n)&&x===t||confirm("Are you sure?"))){await P.remove(n),i(n);return}let I=document.getElementById(`form-inner-${n}`);(I.value.length===0||m.base64Encode(I.value)===I.getAttribute("data-original")&&x===t||confirm("Are you sure?"))&&i(n)},show:r,showMore:k,showOrHide:y}})();var fe=(()=>{let l=()=>te.getDetailUser().then(s=>{m.safeInnerHTML(document.getElementById("dashboard-name"),`${m.escapeHtml(s.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`),document.getElementById("dashboard-email").textContent=s.data.email,document.getElementById("dashboard-accesskey").value=s.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",s.data.access_key),document.getElementById("form-name").value=m.escapeHtml(s.data.name),document.getElementById("filterBadWord").checked=!!s.data.is_filter,document.getElementById("replyComment").checked=!!s.data.can_reply,document.getElementById("editComment").checked=!!s.data.can_edit,document.getElementById("deleteComment").checked=!!s.data.can_delete,document.getElementById("dashboard-tenorkey").value=s.data.tenor_key,H("config").set("tenor_key",s.data.tenor_key)}),u=()=>{M(F,"/api/stats").token(S.getToken()).send().then(s=>{document.getElementById("count-comment").textContent=String(s.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").textContent=String(s.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").textContent=String(s.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").textContent=String(s.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")})},v=async s=>{let g=m.disableCheckbox(s);await M(W,"/api/user").token(S.getToken()).body({filter:!!s.checked}).send(),g.restore()},o=async s=>{let g=m.disableCheckbox(s);await M(W,"/api/user").token(S.getToken()).body({can_reply:!!s.checked}).send(),g.restore()},d=async s=>{let g=m.disableCheckbox(s);await M(W,"/api/user").token(S.getToken()).body({can_edit:!!s.checked}).send(),g.restore()},f=async s=>{let g=m.disableCheckbox(s);await M(W,"/api/user").token(S.getToken()).body({can_delete:!!s.checked}).send(),g.restore()},p=async s=>{let g=m.disableButton(s),L=document.getElementById("dashboard-tenorkey");L.disabled=!0,await M(W,"/api/user").token(S.getToken()).body({tenor_key:L.value.length?L.value:null}).send().then(()=>alert(`success ${L.value.length?"add":"remove"} tenor key`)),L.disabled=!1,g.restore()},$=async s=>{if(!confirm("Are you sure?"))return;let g=m.disableButton(s);await M(se,"/api/key").token(S.getToken()).send(N.statusResponse).then(L=>{L.data.status&&l()}),g.restore()},i=async s=>{let g=document.getElementById("old_password"),L=document.getElementById("new_password");if(g.value.length===0||L.value.length===0){alert("Password cannot be empty");return}g.disabled=!0,L.disabled=!0;let D=m.disableButton(s),_=await M(W,"/api/user").token(S.getToken()).body({old_password:g.value,new_password:L.value}).send(N.statusResponse).then(a=>a.data.status,()=>!1);D.restore(!0),g.disabled=!1,L.disabled=!1,_&&(g.value=null,L.value=null,alert("Success change password"))},y=async s=>{let g=document.getElementById("form-name");if(g.value.length===0){alert("Name cannot be empty");return}g.disabled=!0;let L=m.disableButton(s),D=await M(W,"/api/user").token(S.getToken()).body({name:g.value}).send(N.statusResponse).then(_=>_.data.status,()=>!1);g.disabled=!1,L.restore(!0),D&&(l(),alert("Success change name"))},k=async s=>{let g=m.disableButton(s);await M(F,"/api/download").token(S.getToken()).download(),g.restore()},w=()=>{let s=document.getElementById("button-change-name");s.disabled&&(s.disabled=!1)},c=()=>{let s=document.getElementById("button-change-password"),g=document.getElementById("old_password");s.disabled&&g.value.length!==0&&(s.disabled=!1)},r=()=>{confirm("Are you sure?")&&te.clearSession()},T=()=>{K.init(),K.setDefault("en"),de.init(),ie.spyTop();let s=async()=>{await l(),u(),re.init(),re.show()};document.addEventListener("hidden.bs.modal",s);try{let g=window.location.href.split("?k=");g.length>1&&g[1].length>=1&&(S.setToken(g[1]),window.history.replaceState({},document.title,g[0]));let L=S.decode()?.exp;if(!L||L<Date.now()/1e3)throw new Error("Invalid token");s()}catch{te.clearSession()}};return{init:()=>(te.init(),ie.init(),S.init(),S.isAdmin()||(H("owns").clear(),H("likes").clear(),H("config").clear(),H("comment").clear(),H("session").clear(),H("information").clear()),window.addEventListener("DOMContentLoaded",T),{util:m,theme:ie,comment:re,admin:{auth:te,navbar:ce,logout:r,tenor:p,download:k,regenerate:$,editComment:d,replyComment:o,deleteComment:f,changeName:y,changePassword:i,changeFilterBadWord:v,enableButtonName:w,enableButtonPassword:c}})}})();(l=>{l.undangan=fe.init()})(window);})();
